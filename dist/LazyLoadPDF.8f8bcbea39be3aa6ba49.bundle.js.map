{"version":3,"file":"LazyLoadPDF.8f8bcbea39be3aa6ba49.bundle.js","mappings":"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","sources":["webpack://uwazi/./app/react/PDF/PDFJS.js","webpack://uwazi/./app/react/PDF/components/PDF.js"],"sourcesContent":["function ownKeys(object, enumerableOnly) {var keys = Object.keys(object);if (Object.getOwnPropertySymbols) {var symbols = Object.getOwnPropertySymbols(object);enumerableOnly && (symbols = symbols.filter(function (sym) {return Object.getOwnPropertyDescriptor(object, sym).enumerable;})), keys.push.apply(keys, symbols);}return keys;}function _objectSpread(target) {for (var i = 1; i < arguments.length; i++) {var source = null != arguments[i] ? arguments[i] : {};i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {_defineProperty(target, key, source[key]);}) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));});}return target;}function _defineProperty(obj, key, value) {if (key in obj) {Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });} else {obj[key] = value;}return obj;} /* eslint-disable import/no-mutable-exports, global-require, prefer-destructuring */\nimport { isClient } from \"../utils\";\nimport { EventBus } from 'pdfjs-dist/web/pdf_viewer';\n\nlet PDFJS = {};\nlet pdfjsLib = {};\nlet textLayerFactory = {};\nif (isClient) {\n  require(\"../../../node_modules/pdfjs-dist/web/pdf_viewer.css\");\n\n  PDFJS = require(\"../../../node_modules/pdfjs-dist/web/pdf_viewer.js\");\n  if (process.env.HOT || process.env.NODE_ENV === 'test') {\n    pdfjsLib = require('pdfjs-dist');\n  } else {\n    pdfjsLib = require('pdfjs-dist/webpack');\n  }\n  pdfjsLib.GlobalWorkerOptions.workerSrc = require('pdfjs-dist/build/pdf.worker.entry');\n  textLayerFactory = new PDFJS.DefaultTextLayerFactory();\n}\n\nexport default _objectSpread(_objectSpread({}, PDFJS), pdfjsLib);\n\nexport { textLayerFactory, EventBus };","var REACT_ELEMENT_TYPE;function _jsx(type, props, key, children) {REACT_ELEMENT_TYPE || (REACT_ELEMENT_TYPE = \"function\" == typeof Symbol && Symbol.for && Symbol.for(\"react.element\") || 60103);var defaultProps = type && type.defaultProps,childrenLength = arguments.length - 3;if (props || 0 === childrenLength || (props = { children: void 0 }), 1 === childrenLength) props.children = children;else if (childrenLength > 1) {for (var childArray = new Array(childrenLength), i = 0; i < childrenLength; i++) childArray[i] = arguments[i + 3];props.children = childArray;}if (props && defaultProps) for (var propName in defaultProps) void 0 === props[propName] && (props[propName] = defaultProps[propName]);else props || (props = defaultProps || {});return { $$typeof: REACT_ELEMENT_TYPE, type: type, key: void 0 === key ? null : \"\" + key, ref: null, props: props, _owner: null };}import PropTypes from 'prop-types';\nimport React, { Component } from 'react';\nimport { SelectionRegion, HandleTextSelection } from 'react-text-selection-handler';\nimport { advancedSort } from \"../../utils/advancedSort\";\nimport { PDFPage } from \"./..\";\nimport { isClient } from \"../../utils\";\nimport PDFJS from \"../PDFJS\";\n\nconst cMapUrl = '/legacy_character_maps/';\nconst cMapPacked = true;\n\nclass PDF extends Component {\n  static getDerivedStateFromProps(props, state) {\n    if (state.filename !== null && state.filename !== props.filename) {\n      return { pdf: { numPages: 0 }, filename: props.filename };\n    }\n\n    return null;\n  }\n\n  constructor(props) {\n    super(props);\n    this._isMounted = false;\n    this.state = { pdf: { numPages: 0 }, filename: props.filename };\n    this.pagesLoaded = {};\n    this.loadDocument(props.file);\n    this.currentPage = '1';\n    this.pages = {};\n    this.pdfReady = false;\n\n    this.pageUnloaded = this.pageUnloaded.bind(this);\n    this.pageLoading = this.pageLoading.bind(this);\n    this.onPageVisible = this.onPageVisible.bind(this);\n    this.onPageHidden = this.onPageHidden.bind(this);\n  }\n\n  componentDidMount() {\n    this._isMounted = true;\n    if (this.pdfContainer) {\n      document.addEventListener('textlayerrendered', (e) => {\n        this.pageLoaded(e.detail.pageNumber);\n      });\n      document.addEventListener('textlayerrendered', this.props.onPageLoaded, { once: true });\n    }\n  }\n\n  shouldComponentUpdate(nextProps, nextState) {\n    return (\n      nextProps.file !== this.props.file ||\n      nextProps.filename !== this.props.filename ||\n      nextProps.style !== this.props.style ||\n      nextState.pdf !== this.state.pdf);\n\n  }\n\n  componentDidUpdate(prevProps) {\n    if (prevProps.filename !== null && this.props.filename !== prevProps.filename) {\n      this.pagesLoaded = {};\n      this.loadDocument(prevProps.file);\n    }\n\n    if (this.state.pdf.numPages && !this.pdfReady) {\n      this.pdfReady = true;\n      this.props.onPDFReady();\n    }\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false;\n  }\n\n  onPageVisible(page, visibility) {\n    this.pages[page] = visibility;\n\n    const pageWithMostVisibility = Object.keys(this.pages).reduce((memo, key) => {\n      if (!this.pages[key - 1] || this.pages[key] > this.pages[key - 1]) {\n        return key;\n      }\n      return memo;\n    }, 1);\n\n    if (this.currentPage !== pageWithMostVisibility) {\n      this.currentPage = pageWithMostVisibility;\n      this.props.onPageChange(Number(pageWithMostVisibility));\n    }\n  }\n\n  onPageHidden(page) {\n    delete this.pages[page];\n  }\n\n  loadDocument(file) {\n    if (isClient) {\n      PDFJS.getDocument({\n        url: file,\n        cMapUrl,\n        cMapPacked }).\n      promise.then((pdf) => {\n        if (this._isMounted) {\n          this.setState({ pdf });\n        }\n      });\n    }\n  }\n\n  pageUnloaded(numPage) {\n    delete this.pagesLoaded[numPage];\n    this.loaded();\n  }\n\n  pageLoading(numPage) {\n    this.pagesLoaded[numPage] = false;\n  }\n\n  pageLoaded(numPage) {\n    this.pagesLoaded[numPage] = true;\n    const allPagesLoaded =\n    Object.keys(this.pagesLoaded).\n    map((p) => this.pagesLoaded[p]).\n    filter((p) => !p).length === 0;\n    if (allPagesLoaded) {\n      this.loaded();\n    }\n  }\n\n  loaded() {\n    const pages = Object.keys(this.pagesLoaded).map((n) => parseInt(n, 10));\n\n    const allConsecutives = advancedSort(pages, { treatAs: 'number' }).reduce((memo, number) => {\n      if (memo === false) {\n        return memo;\n      }\n\n      if (memo === null) {\n        return number;\n      }\n\n      return number - memo > 1 ? false : number;\n    }, null);\n\n    if (allConsecutives) {\n      this.props.onLoad({\n        pages });\n\n    }\n  }\n\n  render() {\n    return /*#__PURE__*/(\n      React.createElement(\"div\", {\n        ref: (ref) => {\n          this.pdfContainer = ref;\n        },\n        style: this.props.style }, /*#__PURE__*/\n\n      _jsx(HandleTextSelection, {\n        onSelect: this.props.onTextSelection,\n        onDeselect: this.props.onTextDeselection }, void 0,\n\n      (() => {\n        const pages = [];\n        for (let page = 1; page <= this.state.pdf.numPages; page += 1) {\n          pages.push( /*#__PURE__*/\n          _jsx(\"div\", { className: \"page-wrapper\" }, page, /*#__PURE__*/\n          _jsx(SelectionRegion, { regionId: page.toString() }, void 0, /*#__PURE__*/\n          _jsx(PDFPage, {\n            onUnload: this.pageUnloaded,\n            onLoading: this.pageLoading,\n            onVisible: this.onPageVisible,\n            onHidden: this.onPageHidden,\n            page: page,\n            pdf: this.state.pdf,\n            highlightReference: this.props.highlightReference }))));\n\n\n\n\n        }\n        return pages;\n      })())));\n\n\n\n  }}\n\n\nPDF.defaultProps = {\n  onPageLoaded: () => {},\n  filename: null,\n  onPageChange: () => {},\n  onPDFReady: () => {},\n  style: {},\n  onTextSelection: () => {},\n  onTextDeselection: () => {},\n  highlightReference: () => {} };\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nexport default PDF;"],"names":["ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","obj","value","configurable","writable","PDFJS","pdfjsLib","textLayerFactory","HOT","GlobalWorkerOptions","workerSrc","DefaultTextLayerFactory","REACT_ELEMENT_TYPE","_jsx","type","props","children","Symbol","for","defaultProps","childrenLength","childArray","Array","propName","$$typeof","ref","_owner","PDF","Component","static","state","filename","pdf","numPages","constructor","super","this","_isMounted","pagesLoaded","loadDocument","file","currentPage","pages","pdfReady","pageUnloaded","bind","pageLoading","onPageVisible","onPageHidden","componentDidMount","pdfContainer","document","addEventListener","e","pageLoaded","detail","pageNumber","onPageLoaded","once","shouldComponentUpdate","nextProps","nextState","style","componentDidUpdate","prevProps","onPDFReady","componentWillUnmount","page","visibility","pageWithMostVisibility","reduce","memo","onPageChange","Number","url","cMapUrl","cMapPacked","promise","then","setState","numPage","loaded","map","p","n","parseInt","treatAs","number","onLoad","render","onSelect","onTextSelection","onDeselect","onTextDeselection","className","regionId","toString","onUnload","onLoading","onVisible","onHidden","highlightReference"],"sourceRoot":""}